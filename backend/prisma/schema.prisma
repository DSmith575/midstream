generator client {
  provider = "prisma-client-js"
}

datasource db {
  // provider = "sqlite"
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// enum Gender {
//   MALE
//   FEMALE
//   OTHER
//   PREFER_NOT_TO_SAY
// }

enum ReferralStatus {
  SUBMITTED
  VIEWED
  ASSIGNED
  REVIEWED
  APPROVED
  REJECTED
}

enum UserRole {
  CLIENT
  WORKER
  ADMIN
  MIDSTREAM
}

model User {
  id                  String               @id @default(uuid())
  googleId            String               @unique
  createdAt           DateTime             @default(now())
  updatedAt           DateTime             @default(now()) @updatedAt
  contactInformation  ContactInformation?
  personalInformation PersonalInformation?
  addressInformation  AddressInformation?
  companyId           String?
  company             Company?             @relation(fields: [companyId], references: [id])
  createdReferrals    ReferralForm[]       @relation("CreatedReferrals")
  assignedReferrals   ReferralForm[]       @relation("AssignedReferrals")
  casesCompleted      Int?                 @default(0)
  casesAssigned       Int?                 @default(0)
  role                UserRole             @default(CLIENT)
  serviceCase         ServiceCase[]        @relation("userServiceCase")
  workerServiceCases  ServiceCase[]        @relation("caseWorkerServiceCase")
  servicePlanComments ServicePlanEntryComment[]
}

model ContactInformation {
  id        String   @id @default(uuid())
  userId    String   @unique
  email     String   @unique
  phone     String
  createdAt DateTime @default(now())
  updatedAt DateTime @default(now()) @updatedAt
  user      User     @relation(fields: [userId], references: [id])
}

model PersonalInformation {
  id            String   @id @default(uuid())
  userId        String   @unique
  firstName     String
  lastName      String
  title         String?
  gender        String
  preferredName String?
  dateOfBirth   DateTime
  createdAt     DateTime @default(now())
  updatedAt     DateTime @default(now()) @updatedAt
  user          User     @relation(fields: [userId], references: [id])
}

model AddressInformation {
  id        String   @id @default(uuid())
  userId    String   @unique
  address   String
  suburb    String
  city      String
  postCode  String
  country   String
  createdAt DateTime @default(now())
  updatedAt DateTime @default(now()) @updatedAt
  user      User     @relation(fields: [userId], references: [id])
}

model ReferralForm {
  id                      String                 @id @default(uuid())
  companyId               String
  userId                  String
  assignedToWorkerId      String?
  createdAt               DateTime               @default(now())
  updatedAt               DateTime               @default(now()) @updatedAt
  status                  ReferralStatus         @default(SUBMITTED)
  communicationId         String                 @unique
  medicalId               String                 @unique
  disabilityId            String                 @unique
  referrerId              String                 @unique
  emergencyContactId      String                 @unique
  consentId               String                 @unique
  additionalInformationId String                 @unique
  user                    User                   @relation("CreatedReferrals", fields: [userId], references: [id])
  assignedToWorker        User?                  @relation("AssignedReferrals", fields: [assignedToWorkerId], references: [id])
  referrer                Referrer               @relation(fields: [referrerId], references: [id])
  emergencyContact        EmergencyContact       @relation(fields: [emergencyContactId], references: [id])
  communication           ReferralCommunication  @relation(fields: [communicationId], references: [id])
  medical                 ReferralMedical        @relation(fields: [medicalId], references: [id])
  disability              ReferralDisability     @relation(fields: [disabilityId], references: [id])
  consent                 ReferralConsent        @relation(fields: [consentId], references: [id])
  additionalInformation   AdditionalInformation? @relation(fields: [additionalInformationId], references: [id])
  company                 Company?               @relation(fields: [companyId], references: [id])
  serviceCase             ServiceCase?
}

model ReferralCommunication {
  id                        String        @id @default(uuid())
  firstLanguage             String
  interpreter               Boolean
  culturalSupport           Boolean?
  communicationNeeds        Boolean?
  communicationNeedsDetails String?
  referral                  ReferralForm?
}

model AdditionalInformation {
  id                        String        @id @default(uuid())
  safety                    String
  otherImportantInformation String?
  referral                  ReferralForm?
}

model ReferralMedical {
  id            String        @id @default(uuid())
  doctorName    String
  doctorPhone   String
  doctorAddress String
  doctorSuburb  String
  doctorCity    String
  nhiNumber     String
  referral      ReferralForm?
}

model ReferralDisability {
  id                          String        @id @default(uuid())
  disabilityType              String
  disabilityDetails           String?
  disabilitySupportDetails    String?
  disabilityReasonForReferral String?
  disabilitySupportRequired   String?
  referral                    ReferralForm?
}

model Referrer {
  id           String         @id @default(uuid())
  firstName    String
  lastName     String
  email        String?
  phone        String
  relationship String
  referrals    ReferralForm[]
}

model EmergencyContact {
  id           String         @id @default(uuid())
  firstName    String
  lastName     String
  phone        String
  email        String?
  relationship String
  referrals    ReferralForm[]
}

model ReferralConsent {
  id                              String        @id @default(uuid())
  provideInformationConsent       Boolean
  provideSharedInformationConsent Boolean
  provideContactConsent           Boolean
  provideStatisticalConsent       Boolean
  provideCorrectInformation       Boolean
  referral                        ReferralForm?
}

model Company {
  id        String         @id @default(uuid())
  name      String
  city      String
  address   String
  suburb    String
  postCode  String
  country   String
  phone     String
  email     String
  website   String?
  createdAt DateTime       @default(now())
  updatedAt DateTime       @default(now()) @updatedAt
  users     User[]
  referrals ReferralForm[]
}

model ServicePlan {
  id            String              @id @default(uuid())
  createdAt     DateTime            @default(now())
  updatedAt     DateTime            @default(now()) @updatedAt
  serviceCaseId String              @unique
  services      ServicePlanEntry[]
  serviceCase   ServiceCase         @relation(fields: [serviceCaseId], references: [id])
}

model ServiceCategory {
  id                  String            @id @default(uuid())
  serviceName         String            @unique
  flexibleHours       Boolean
  // Might be useful down the line
  // parentCategoryId    String?
  // parentCategory      ServiceCategory   @relation(fields: [parentCategoryId], references: [id])
  servicePlanEntries  ServicePlanEntry[]
}

model ServicePlanEntry {
  id                String          @id @default(uuid())
  servicePlanId     String
  serviceCategoryId String
  allocatedMinutes  Int             // Store as int minutes, convert to fractional hours in code
  servicePlan       ServicePlan     @relation(fields: [servicePlanId], references: [id])
  serviceCategory   ServiceCategory @relation(fields: [serviceCategoryId], references: [id])
  comments          ServicePlanEntryComment[]
}

model ServicePlanEntryComment {
  id                  String            @id @default(uuid())
  servicePlanEntryId  String
  comment             String
  authorId            String
  servicePlanEntry    ServicePlanEntry  @relation(fields: [servicePlanEntryId], references: [id])
  author              User              @relation(fields: [authorId], references: [id])
}

model ServiceCase {
  id                  String            @id @default(uuid())
  userId              String
  workerId            String
  referralFormId      String?           @unique
  // assessmentId     String
  user                User              @relation("userServiceCase", fields: [userId], references: [id])
  caseWorker          User              @relation("caseWorkerServiceCase", fields: [workerId], references: [id])
  referralForm        ReferralForm?     @relation(fields: [referralFormId], references: [id])
  // assessment       Assessment        @relation(fields: [assessmentId], references: [id])
  servicePlan         ServicePlan?
}