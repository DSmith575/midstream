generator client {
  provider = "prisma-client-js"
}

datasource db {
  // provider = "sqlite"
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// enum Gender {
//   MALE
//   FEMALE
//   OTHER
//   PREFER_NOT_TO_SAY
// }

enum ReferralStatus {
  SUBMITTED
  VIEWED
  REVIEWED
  APPROVED
  REJECTED
}

enum UserRole {
  CLIENT
  WORKER
  ADMIN
  MIDSTREAM
}

model User {
  id                    String               @id @default(uuid())
  googleId              String               @unique
  createdAt             DateTime             @default(now())
  updatedAt             DateTime             @default(now()) @updatedAt
  contactInformation    ContactInformation?  @relation(fields: [contactInformationId], references: [id])
  personalInformation   PersonalInformation? @relation(fields: [personalInformationId], references: [id])
  addressInformation    AddressInformation?  @relation(fields: [addressInformationId], references: [id])
  createdReferrals      ReferralForm[]       @relation("CreatedReferrals")
  assignedReferrals     ReferralForm[]       @relation("AssignedReferrals")
  casesCompleted        Int?                 @default(0)
  casesAssigned         Int?                 @default(0)
  role                  UserRole             @default(CLIENT)
  company               Company?             @relation(fields: [companyInformationId], references: [id])
  companyInformationId  String?              @unique
  personalInformationId String?              @unique
  contactInformationId  String?              @unique
  addressInformationId  String?              @unique
}

model ContactInformation {
  id        String   @id @default(uuid())
  userId    Int      @unique
  email     String   @unique
  phone     String
  createdAt DateTime @default(now())
  updatedAt DateTime @default(now()) @updatedAt
  user      User[]
}

model PersonalInformation {
  id            String   @id @default(uuid())
  userId        Int      @unique
  firstName     String
  lastName      String
  title         String?
  gender        String
  preferredName String?
  dateOfBirth   DateTime
  createdAt     DateTime @default(now())
  updatedAt     DateTime @default(now()) @updatedAt
  user          User[]
}

model AddressInformation {
  id        String   @id @default(uuid())
  userId    Int      @unique
  address   String
  suburb    String
  city      String
  postCode  String
  country   String
  createdAt DateTime @default(now())
  updatedAt DateTime @default(now()) @updatedAt
  user      User[]
}

model ReferralForm {
  id                      String                 @id @default(uuid())
  companyId               String
  userId                  String
  assignedToWorkerId      String?
  createdAt               DateTime               @default(now())
  updatedAt               DateTime               @default(now()) @updatedAt
  status                  ReferralStatus         @default(SUBMITTED)
  communicationId         String                 @unique
  medicalId               String                 @unique
  disabilityId            String                 @unique
  referrerId              String                 @unique
  emergencyContactId      String                 @unique
  consentId               String                 @unique
  additionalInformationId String                 @unique
  user                    User                   @relation("CreatedReferrals", fields: [userId], references: [id])
  assignedToWorker        User?                  @relation("AssignedReferrals", fields: [assignedToWorkerId], references: [id])
  referrer                Referrer               @relation(fields: [referrerId], references: [id])
  emergencyContact        EmergencyContact       @relation(fields: [emergencyContactId], references: [id])
  communication           ReferralCommunication  @relation(fields: [communicationId], references: [id])
  medical                 ReferralMedical        @relation(fields: [medicalId], references: [id])
  disability              ReferralDisability     @relation(fields: [disabilityId], references: [id])
  consent                 ReferralConsent        @relation(fields: [consentId], references: [id])
  additionalInformation   AdditionalInformation? @relation(fields: [additionalInformationId], references: [id])
  company                 Company?               @relation(fields: [companyId], references: [id])
}

model ReferralCommunication {
  id                        String        @id @default(uuid())
  firstLanguage             String
  interpreter               Boolean
  culturalSupport           Boolean?
  communicationNeeds        Boolean?
  communicationNeedsDetails String?
  referral                  ReferralForm?
}

model AdditionalInformation {
  id                        String        @id @default(uuid())
  safety                    String
  otherImportantInformation String?
  referral                  ReferralForm?
}

model ReferralMedical {
  id            String        @id @default(uuid())
  doctorName    String
  doctorPhone   String
  doctorAddress String
  doctorSuburb  String
  doctorCity    String
  nhiNumber     String
  referral      ReferralForm?
}

model ReferralDisability {
  id                          String        @id @default(uuid())
  disabilityType              String
  disabilityDetails           String?
  disabilitySupportDetails    String?
  disabilityReasonForReferral String?
  disabilitySupportRequired   String?
  referral                    ReferralForm?
}

model Referrer {
  id           String         @id @default(uuid())
  firstName    String
  lastName     String
  email        String?
  phone        String
  relationship String
  referrals    ReferralForm[]
}

model EmergencyContact {
  id           String         @id @default(uuid())
  firstName    String
  lastName     String
  phone        String
  email        String?
  relationship String
  referrals    ReferralForm[]
}

model ReferralConsent {
  id                              String        @id @default(uuid())
  provideInformationConsent       Boolean
  provideSharedInformationConsent Boolean
  provideContactConsent           Boolean
  provideStatisticalConsent       Boolean
  provideCorrectInformation       Boolean
  referral                        ReferralForm?
}

model Company {
  id        String         @id @default(uuid())
  name      String         @unique
  city      String
  address   String
  suburb    String
  postCode  Int
  country   String
  phone     String
  email     String         @unique
  website   String?
  createdAt DateTime       @default(now())
  updatedAt DateTime       @default(now()) @updatedAt
  users     User[]
  referrals ReferralForm[]
}
